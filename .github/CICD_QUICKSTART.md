# âš¡ CI/CD å¿«é€Ÿé–‹å§‹æŒ‡å—

5 åˆ†é˜è¨­ç½®è‡ªå‹•åŒ–éƒ¨ç½²ï¼

---

## ğŸ¯ ä½ å°‡ç²å¾—ä»€éº¼

âœ… æ¨é€ä»£ç¢¼ â†’ è‡ªå‹•æ§‹å»º
âœ… è‡ªå‹•æ¸¬è©¦ â†’ ç™¼ç¾å•é¡Œ
âœ… è‡ªå‹•éƒ¨ç½² â†’ VM ä¸Šç·š
âœ… è‡ªå‹•ä¿®å¾© â†’ æ™ºèƒ½å„ªåŒ–
âœ… è‡ªå‹•é€šçŸ¥ â†’ å¯¦æ™‚åé¥‹

---

## ğŸ“‹ å‰ç½®æº–å‚™

### ä½ éœ€è¦æœ‰ï¼š
- âœ… GitHub å¸³è™Ÿ
- âœ… ä¸€å° VMï¼ˆUbuntu 20.04+ï¼‰
- âœ… SSH è¨ªå•æ¬Šé™
- âœ… 5 åˆ†é˜æ™‚é–“

### ä½ ä¸éœ€è¦ï¼š
- âŒ è¤‡é›œçš„é…ç½®
- âŒ DevOps å°ˆæ¥­çŸ¥è­˜
- âŒ æ˜‚è²´çš„æœå‹™

---

## ğŸš€ 3 æ­¥é©Ÿè¨­ç½®

### æ­¥é©Ÿ 1ï¼šæº–å‚™ VMï¼ˆ1 åˆ†é˜ï¼‰

SSH åˆ°ä½ çš„ VMï¼Œé‹è¡Œé€™å€‹ä¸€éµå®‰è£è…³æœ¬ï¼š

```bash
curl -fsSL https://raw.githubusercontent.com/your-repo/idea-hub/main/_deploy/setup-vm.sh | bash
```

æˆ–æ‰‹å‹•åŸ·è¡Œï¼š

```bash
# æ›´æ–°ä¸¦å®‰è£å¿…è¦è»Ÿé«”
sudo apt update && sudo apt install -y nginx ruby-full build-essential git

# å‰µå»ºéƒ¨ç½²ç›®éŒ„
sudo mkdir -p /var/www/idea-hub
sudo chown -R $USER:$USER /var/www/idea-hub

# å®‰è£ Jekyll
gem install jekyll bundler
```

### æ­¥é©Ÿ 2ï¼šè¨­ç½® SSH é‡‘é‘°ï¼ˆ2 åˆ†é˜ï¼‰

**åœ¨æœ¬åœ°ï¼š**

```bash
# 1. ç”Ÿæˆ SSH é‡‘é‘°
ssh-keygen -t ed25519 -C "deploy" -f ~/.ssh/idea-hub-deploy

# 2. è¤‡è£½å…¬é‘°åˆ° VM
ssh-copy-id -i ~/.ssh/idea-hub-deploy.pub your-user@your-vm-ip

# 3. æ¸¬è©¦é€£æ¥
ssh -i ~/.ssh/idea-hub-deploy your-user@your-vm-ip
```

### æ­¥é©Ÿ 3ï¼šè¨­ç½® GitHub Secretsï¼ˆ2 åˆ†é˜ï¼‰

**åœ¨ GitHub Repositoryï¼š**

1. é€²å…¥ `Settings` â†’ `Secrets and variables` â†’ `Actions`
2. æ·»åŠ ä»¥ä¸‹ Secretsï¼š

```
VM_HOST = your-vm-ip-or-domain
VM_USER = your-username
VM_SSH_KEY = (è¤‡è£½ ~/.ssh/idea-hub-deploy çš„å…§å®¹)
VM_DEPLOY_PATH = /var/www/idea-hub
```

**ç²å–ç§é‘°å…§å®¹ï¼š**
```bash
cat ~/.ssh/idea-hub-deploy
# è¤‡è£½å®Œæ•´è¼¸å‡ºï¼ˆåŒ…æ‹¬ BEGIN å’Œ END è¡Œï¼‰
```

---

## âœ… æ¸¬è©¦éƒ¨ç½²

### æ¨é€ä»£ç¢¼è§¸ç™¼éƒ¨ç½²ï¼š

```bash
git add .
git commit -m "ğŸš€ æ¸¬è©¦è‡ªå‹•éƒ¨ç½²"
git push origin main
```

### æŸ¥çœ‹éƒ¨ç½²ç‹€æ…‹ï¼š

1. é€²å…¥ GitHub Repository
2. é»æ“Š `Actions` æ¨™ç±¤
3. æŸ¥çœ‹å·¥ä½œæµé‹è¡Œç‹€æ…‹

### é©—è­‰éƒ¨ç½²ï¼š

```bash
# è¨ªå•ä½ çš„ç¶²ç«™
curl http://your-vm-ip

# æˆ–åœ¨ç€è¦½å™¨æ‰“é–‹
open http://your-vm-ip
```

---

## ğŸ“Š å·¥ä½œæµç¨‹æ¦‚è¦½

```
ä½ æ¨é€ä»£ç¢¼åˆ° GitHub
        â†“
GitHub Actions è‡ªå‹•è§¸ç™¼
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                 â”‚
æ§‹å»º Jekyll       é‹è¡Œæ¸¬è©¦
   â”‚                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
      æ¸¬è©¦é€šéï¼Ÿ
            â†“
        â”Œâ”€â”€â”€â”´â”€â”€â”€â”
       YES     NO
        â”‚       â”‚
    éƒ¨ç½²åˆ° VM  å‰µå»º Issue
        â”‚       â”‚
   å¥åº·æª¢æŸ¥  è‡ªå‹•ä¿®å¾©
        â”‚       â”‚
   âœ… å®Œæˆ   ğŸ“ PR
```

---

## ğŸ§ª å¯ç”¨çš„æ¸¬è©¦

ç³»çµ±æœƒè‡ªå‹•é‹è¡Œä»¥ä¸‹æ¸¬è©¦ï¼š

### âœ… æ§‹å»ºæ¸¬è©¦
- Jekyll æ§‹å»ºæˆåŠŸ
- ç„¡æ§‹å»ºéŒ¯èª¤

### ğŸ”— é€£çµæ¸¬è©¦
- æª¢æŸ¥å…§éƒ¨é€£çµ
- æª¢æŸ¥åœ–ç‰‡è³‡æº
- æª¢æŸ¥å¤–éƒ¨é€£çµï¼ˆå¯é¸ï¼‰

### ğŸ“ å…§å®¹æ¸¬è©¦
- Front matter å®Œæ•´æ€§
- æ–‡ç« æ ¼å¼æ­£ç¢º
- å¿…è¦æ¬„ä½å­˜åœ¨

### ğŸ¯ SEO æ¸¬è©¦
- Title å’Œ Description
- æ¨™é¡Œçµæ§‹
- åœ–ç‰‡ Alt å±¬æ€§

### âš¡ æ€§èƒ½æ¸¬è©¦
- æ–‡ä»¶å¤§å°
- åœ–ç‰‡å„ªåŒ–
- è³‡æºå£“ç¸®

---

## ğŸ”§ è‡ªå‹•ä¿®å¾©åŠŸèƒ½

ç³»çµ±æœƒè‡ªå‹•ä¿®å¾©é€™äº›å•é¡Œï¼š

âœ… ç§»é™¤å¤šé¤˜ç©ºè¡Œ
âœ… æ¸…ç†è¡Œå°¾ç©ºæ ¼
âœ… ä¿®æ­£æå£çš„é€£çµ
âœ… æ·»åŠ ç¼ºå¤±çš„ Front Matter
âœ… å„ªåŒ–åœ–ç‰‡å¤§å°

ç„¡æ³•è‡ªå‹•ä¿®å¾©çš„å•é¡Œæœƒå‰µå»º Issue é€šçŸ¥ä½ ã€‚

---

## ğŸ›ï¸ è‡ªå®šç¾©é…ç½®

### ä¿®æ”¹éƒ¨ç½²è§¸ç™¼æ¢ä»¶

ç·¨è¼¯ `.github/workflows/deploy.yml`ï¼š

```yaml
on:
  push:
    branches:
      - main        # æ”¹æˆä½ çš„ä¸»åˆ†æ”¯
      - develop     # å¯ä»¥æ·»åŠ æ›´å¤šåˆ†æ”¯
```

### å•Ÿç”¨/ç¦ç”¨æ¸¬è©¦

åœ¨ `.github/workflows/deploy.yml` ä¸­è¨»é‡‹ä¸éœ€è¦çš„æ¸¬è©¦ï¼š

```yaml
# - name: ğŸ”— Check external links
#   run: python _tests/test_links.py --check-external
```

### è¨­ç½®é€šçŸ¥

æ·»åŠ  Slack webhook åˆ° GitHub Secretsï¼š

```
SLACK_WEBHOOK = https://hooks.slack.com/services/YOUR/WEBHOOK/URL
```

---

## ğŸ“Š ç›£æ§å’Œæ—¥èªŒ

### æŸ¥çœ‹éƒ¨ç½²æ—¥èªŒ

**GitHub Actionsï¼š**
```
Repository â†’ Actions â†’ é»æ“Šå·¥ä½œæµé‹è¡Œ â†’ æŸ¥çœ‹æ—¥èªŒ
```

**VM ä¸Šï¼š**
```bash
# Nginx è¨ªå•æ—¥èªŒ
tail -f /var/www/idea-hub/logs/access.log

# Nginx éŒ¯èª¤æ—¥èªŒ
tail -f /var/www/idea-hub/logs/error.log

# éƒ¨ç½²æ—¥èªŒ
ls -la /var/www/idea-hub/backup-*
```

### å¥åº·æª¢æŸ¥

éƒ¨ç½²å¾Œæœƒè‡ªå‹•é€²è¡Œå¥åº·æª¢æŸ¥ï¼š
- HTTP ç‹€æ…‹ç¢¼æª¢æŸ¥
- éŸ¿æ‡‰æ™‚é–“æ¸¬è©¦
- å…§å®¹å®Œæ•´æ€§é©—è­‰

---

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q: GitHub Actions å¤±æ•—æ€éº¼è¾¦ï¼Ÿ

**A:** æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒï¼š
```
Actions â†’ é»æ“Šå¤±æ•—çš„é‹è¡Œ â†’ å±•é–‹å¤±æ•—çš„æ­¥é©Ÿ
```

å¸¸è¦‹åŸå› ï¼š
- SSH é‡‘é‘°è¨­ç½®éŒ¯èª¤
- Secrets é…ç½®éŒ¯èª¤
- VM ç£ç›¤ç©ºé–“ä¸è¶³

### Q: ç¶²ç«™é¡¯ç¤º 404ï¼Ÿ

**A:** æª¢æŸ¥éƒ¨ç½²ç›®éŒ„ï¼š
```bash
ssh your-user@your-vm-ip
ls -la /var/www/idea-hub/current/
```

ç¢ºä¿ `index.html` å­˜åœ¨ã€‚

### Q: æ¸¬è©¦ç¸½æ˜¯å¤±æ•—ï¼Ÿ

**A:** å…ˆåœ¨æœ¬åœ°é‹è¡Œæ¸¬è©¦ï¼š
```bash
cd _tests
python test_links.py
python test_content.py
```

ä¿®å¾©æœ¬åœ°å•é¡Œå¾Œå†æ¨é€ã€‚

### Q: å¦‚ä½•å›æ»¾éƒ¨ç½²ï¼Ÿ

**A:** SSH åˆ° VMï¼š
```bash
cd /var/www/idea-hub
ls -t backup-*  # æŸ¥çœ‹å‚™ä»½
cp -r backup-YYYYMMDD-HHMMSS current  # æ¢å¾©å‚™ä»½
sudo systemctl reload nginx
```

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥

### åŸºç¤è¨­ç½®å®Œæˆå¾Œï¼š

1. **å•Ÿç”¨ HTTPS**
   ```bash
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d your-domain.com
   ```

2. **è¨­ç½®å®šæœŸæ¸¬è©¦**
   - æ¯å¤©è‡ªå‹•é‹è¡Œæ¸¬è©¦
   - å¥åº·æª¢æŸ¥å’Œæ€§èƒ½ç›£æ§

3. **å„ªåŒ–æ€§èƒ½**
   - å•Ÿç”¨ CDN
   - åœ–ç‰‡å£“ç¸®
   - ç·©å­˜å„ªåŒ–

---

## ğŸ“š æ›´å¤šè³‡æº

- ğŸ“– [å®Œæ•´éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md)
- ğŸ—ï¸ [CI/CD æ¶æ§‹è¨­è¨ˆ](./CI_CD_DESIGN.md)
- ğŸ§ª [æ¸¬è©¦å¥—ä»¶æ–‡æª”](../_tests/README.md)

---

## ğŸ’¬ ç²å–å¹«åŠ©

é‡åˆ°å•é¡Œï¼Ÿ

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](./DEPLOYMENT_GUIDE.md#-æ•…éšœæ’é™¤)
2. æŸ¥çœ‹ GitHub Actions æ—¥èªŒ
3. æŸ¥çœ‹ VM æ—¥èªŒæ–‡ä»¶
4. æäº¤ Issue

---

**æ­å–œï¼ğŸ‰ ä½ ç¾åœ¨æ“æœ‰ä¸€å€‹å…¨è‡ªå‹•çš„éƒ¨ç½²ç³»çµ±ï¼**

æ¯æ¬¡æ¨é€ä»£ç¢¼ï¼Œç³»çµ±æœƒï¼š
- âœ… è‡ªå‹•æ§‹å»º
- âœ… è‡ªå‹•æ¸¬è©¦
- âœ… è‡ªå‹•éƒ¨ç½²
- âœ… è‡ªå‹•é€šçŸ¥

**ä½ åªéœ€è¦å°ˆæ³¨å¯«ä½œï¼Œå…¶ä»–çš„äº¤çµ¦è‡ªå‹•åŒ–ï¼** ğŸš€
